<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="autocomplete.css">
</head>
<body>
    <h1>Autocomplete for Native Javascript</h1>
    
    <input id="search" type="text" placeholder="Search..." autocomplete="off">
    
    <script src="autocomplete.js"></script>
    <script>
        var autocomplete = new Autocomplete({
            selector: "#search",
            minChar: 1,
            maxListHeight: 400,
            ajax: {
                method: "GET",
                url: "https://kitsu.io/api/edge/anime",
                withCredentials: false,
                fields: "?fields[anime]=titles&page[limit]=10&filter[text]",
                responseHandler: function(response){
                    var array = JSON.parse(response).data
                                    .map(v=>v.attributes.titles.en || v.attributes.titles.en_jp)
                                    .filter(v=>v) // remove false/undefined values
                    console.log(array, 'array')
                    return array
                },
            },
            fixSearch : function(str){
                return str.toLowerCase()
            },
            // manualAjax: function(value){
            //     return new Promise(function(resolve, reject){
            //         var request = new XMLHttpRequest();
            //         request.open('GET', 'https://kitsu.io/api/edge/anime?fields[anime]=titles&page[limit]=20&filter[text]='+value, true);
            //         request.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            //         request.onreadystatechange = function() {
            //             if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
            //                 console.log('succeed');
            //                 console.log(request.responseText);
            //                 var array = JSON.parse(request.responseText).data.map(v=>v.attributes.titles.en || v.attributes.titles.en_jp)
            //                 resolve(array)
            //             }else{
            //                 console.log('server error');
            //             }
            //         };
            //         request.onerror = function(e) {
            //             console.log('something went wrong');
            //             reject(e)
            //         };
            //         request.send();
            //     })
            // },

            submitHandler: function(str){
                console.log("Searched: "+str)
            }
        })
    </script>
</body>
</html>